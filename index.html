<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>Symfony2 Security &amp; Websockets</title>

    <link href="slideshow.css" rel="stylesheet" />
    <link href="reusable.css" rel="stylesheet" />
    <link href="theme.css" rel="stylesheet" />
    <link href="talk.css" rel="stylesheet" />
    <script src="prefixfree.min.js"></script>
</head>
<body data-duration="20">

<header id="intro" class="slide">
    <h1>
        Symfony 2 Security<br/>&amp; Websockets
        <small>Working with tickets</small>
    </h1>
</header>

<section title="What's websocket?">
    <header class="slide">
        <h1>What's websocket?</h1>
    </header>

    <section class="slide">
        <h2>What's websocket?</h2>
        <ul>
            <li class="delayed">A client/server connexion</li>
            <li class="delayed">Work both ways</li>
            <li class="delayed">Stays open</li>
            <li class="delayed">Event based</li>
        </ul>
    </section>

    <section class="slide">
        <h2>How it's done</h2>
        <p>Starts with an HTTP request:</p>
        <pre><code>GET /socket.io/1/websocket/6mDqTWQ0hWpKY5V_GYWo HTTP/1.1
Host:websocket.symfony2.local:8000
Upgrade:websocket
Connection:Upgrade
Sec-WebSocket-Key:ijIdeSs13H1t6Ez3rZtdaA==
Sec-WebSocket-Version:13
Origin:http://websocket.symfony2.local
Cookie:PHPSESSID=pnsdaav81i2v1lpopenbd9aq93</code></pre>
    </section>

    <section class="slide">
        <h2>How it's done</h2>
        <p>And the server's response:</p>
        <pre><code>HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Sec-WebSocket-Accept: 6GRVpnnWRvk90r/nLFsxfrP3+D0=
Upgrade: websocket</code></pre>
    </section>

    <section class="slide">
        <h2>Event system</h2>
        <pre class="delayed"><code lang="javascript">socket.emit(
    "user:say",
    {user: 1, message: "Hi."}
);</code></pre>
        <pre class="delayed"><code lang="javascript">socket.on(
    "user:say",
    function (data) { console.log(data.message); }
);</code></pre>
    </section>
</section>

<section title="The security problem">
    <header class="slide">
        <h1>
            <a href="http://websocket.symfony2.local/" target="_blank">
                See it in action
            </a>
        </h1>
    </header>
<section>

<section title="The security problem">
    <header class="slide">
        <h1>The security problem</h1>
    </header>

    <section class="slide">
        <h2>Node JS + Socket.io</h2>
        <ul>
            <li class="delayed">No authentication</li>
            <li class="delayed">No authorization</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Anyone can connect</h2>
        <pre class="delayed"><code lang="javascript">var script = document.createElement("script");
script.src = "http://websocket.symfony2.local/socket.io/socket.io.js";
document.body.appendChild(script);</code></pre>
<pre class="delayed"><code lang="javascript">var socket = io.connect(
    "http://websocket.symfony2.local/",
    { port: 8000, transports: ["websocket"] }
);</code></pre>
    </section>

    <section class="slide">
        <h2>The ticket pattern</h2>
        <ul>
            <li class="delayed">Let Symfony handle the security</li>
            <li class="delayed">Give Node a single simple task</li>
        </ul>
    </section>

    <section class="slide image partial">
        <img src="img/ticket_pattern/http-request.svg" width="100%" />
    </section>

    <section class="slide image partial">
        <img src="img/ticket_pattern/forge-ticket.svg" width="100%" />
    </section>

    <section class="slide image partial">
        <img src="img/ticket_pattern/server-side-ticket.svg" width="100%" />
    </section>

    <section class="slide image partial">
        <img src="img/ticket_pattern/http-response.svg" width="100%" />
    </section>

    <section class="slide image partial">
        <img src="img/ticket_pattern/handshake-request.svg" width="100%" />
    </section>

    <section class="slide image partial">
        <img src="img/ticket_pattern/check-ticket.svg" width="100%" />
    </section>

    <section class="slide image partial">
        <img src="img/ticket_pattern/handshake-response.svg" width="100%" />
    </section>
</section>

<section title="Sample implementation">
    <header class="slide">
        <h1>Sample implementation</h1>
    </header>

    <section class="slide">
        <h2>Forge a Ticket when you need it</h2>
        <ul>
            <li class="delayed">On a specific route</li>
            <li class="delayed">On each Request</li>
            <li class="delayed">On client's demand</li>
        </ul>
    </section>
</section>

<footer class="slide" title="The End">
    <h2>Thank you!</h2>
    <p>Give it a try: <a href="https://github.com/Tom32i/sf2-security-websocket">https://github.com/Tom32i/sf2-security-websocket</a></p>
    <br/>
    <p>Sources:</p>
    <ul>
        <li><a href="https://devcenter.heroku.com/articles/websocket-security" target="_blank">Websocket Security</a> by Heroku Dev Center</li>
        <li><a href="http://lucumr.pocoo.org/2012/9/24/websockets-101/" target="_blank">Websockets 101</a> by Armin Ronacher</li>
    </ul>
    <br/>
    <p>Credits:</p>
    <ul>
        <li>With the help and advices of Yehya Latti, Benjamin Lévèque and the <a href="http://elao.com" target="_blank">Elao</a> team</li>
        <li><a href="https://github.com/LeaVerou/CSSS" target="_blank">CSSS</a> by Lea Verou</li>
        <li><a href="http://instagram.com/yurbasikng" target="_blank">Handcrafted Wallpaper</a> by Yuriy Khimanin</li>
    </ul>
</footer>

<script src="slideshow.js"></script>
<script src="plugins/css-edit.js"></script>
<script src="plugins/css-snippets.js"></script>
<script src="plugins/css-controls.js"></script>
<script src="plugins/code-highlight.js"></script>
<script>
var slideshow = new SlideShow();

var snippets = document.querySelectorAll('.snippet');
for(var i=0; i<snippets.length; i++) {
    new CSSSnippet(snippets[i]);
}

var cssControls = document.querySelectorAll('.css-control');
for(var i=0; i<cssControls.length; i++) {
    new CSSControl(cssControls[i]);
}
</script>

</body>
</html>